var shareImageButton=document.querySelector("#share-image-button"),createPostArea=document.querySelector("#create-post"),closeCreatePostModalButton=document.querySelector("#close-create-post-modal-btn"),sharedMomentsArea=document.querySelector("#shared-moments"),form=document.querySelector("form"),titleInput=document.querySelector("#title");function openCreatePostModal(){createPostArea.style.transform="translateY(0)",initializeMedia(),initializeLocation(),deferredPrompt&&(deferredPrompt.prompt(),deferredPrompt.userChoice.then(function(e){console.log(e.outcome),"dismissed"===e.outcome?console.log("User cancelled installation"):console.log("User added to home screen")}),deferredPrompt=null)}function closeCreatePostModal(){setTimeout(function(){createPostArea.style.transform="translateY(100vh)"},1)}function onSaveButtonClicked(e){console.log("clicked"),"caches"in window&&caches.open("user-requested").then(function(e){e.add("https://httpbin.org/get"),e.add("/src/images/sf-boat.jpg")})}function clearCards(){for(;sharedMomentsArea.hasChildNodes();)sharedMomentsArea.removeChild(sharedMomentsArea.lastChild)}function createCard(e){var t=document.createElement("div");t.className="shared-moment-card mdl-card mdl-shadow--2dp";var a=document.createElement("div");a.className="mdl-card__title",a.style.backgroundImage="url("+e.image+")",a.style.backgroundSize="cover",a.style.height="180px",t.appendChild(a);var o=document.createElement("h2");o.style.color="white",o.className="mdl-card__title-text",o.textContent=e.title,a.appendChild(o);o=document.createElement("div");o.className="mdl-card__supporting-text",o.textContent=e.location,o.style.textAlign="center",t.appendChild(o),componentHandler.upgradeElement(t),sharedMomentsArea.appendChild(t)}function updateUi(t){clearCards();for(let e=0;e<t.length;e++)createCard(t[e])}shareImageButton.addEventListener("click",openCreatePostModal),closeCreatePostModalButton.addEventListener("click",closeCreatePostModal);var networkDataReceived=!1;function sendData(){var e=(new Date).toISOString(),t=new FormData;t.append("id",e),t.append("title",titleInput.value),t.append("location",locationInput.value),t.append("rawLocationLat",rawLocation.lat),t.append("rawLocationLng",rawLocation.lng),t.append("file",picture,e+".png"),fetch("https://us-central1-pwagram-ce869.cloudfunctions.net/storePostData",{method:"POST",body:t}).then(function(e){console.log("Sent data",e),updateUI()})}fetch("https://pwagram-ce869-default-rtdb.europe-west1.firebasedatabase.app/posts.json").then(function(e){return e.json()}).then(function(e){networkDataReceived=!0,console.log("From web",e);var t,a=[];for(t in e)a.push(e[t]);updateUi(a)}),"indexedDB"in window&&readAllData("posts").then(function(e){networkDataReceived||(console.log("From cache",e),updateUi(e))}),form.addEventListener("submit",function(e){e.preventDefault(),""!==titleInput.value.trim()&&""!==locationInput.value.trim()?(closeCreatePostModal(),"serviceWorker"in navigator&&"SyncManager"in window?navigator.serviceWorker.ready.then(function(e){var t={id:(new Date).toISOString(),title:titleInput.value,location:locationInput.value,picture:picture,rawLocation:fetchedLocation};writeData("sync-posts",t).then(function(){return e.sync.register("sync-new-posts")}).then(function(){document.querySelector("#confirmation-toast").MaterialSnackbar.showSnackbar({message:"Your Post was saved for syncing!"})}).catch(function(e){console.log(e)})}):sendData()):alert("Please enter valid data!")});